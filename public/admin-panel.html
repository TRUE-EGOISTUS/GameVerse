<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="gradient-bg">
  <header>
    <div class="header-content">
      <h1 class="neon-text">üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
      <nav>
        <a href="index.html" class="btn neon-btn">‚Üê –ù–∞–∑–∞–¥</a>
      </nav>
    </div>
  </header>
  <main class="main-content">
    <div class="glass-card">
      <h2 class="neon-subtitle">üìã –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
      <div id="userList" class="user-list"></div>
    </div>
  </main>
  <script>
    async function loadUsers() {
      try {
        const token = localStorage.getItem('token');
        if (!token) {
          alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω');
          window.location.href = '/login.html';
          return;
        }

        const response = await fetch("/admin/users", {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (response.status === 403) {
          alert('–ù–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞');
          window.location.href = '/';
          return;
        }

        if (!response.ok) throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π");
        
        const users = await response.json();
        const userList = document.getElementById("userList");
        userList.innerHTML = users.map(user => `
          <div class="user-card">
            <div class="user-info-header">
              <span class="user-name">üë§ <strong>${user.username}</strong></span>
              <span class="user-status ${user.online ? 'status-online' : 'status-offline'}">
                ${user.online ? "üü¢ –í —Å–µ—Ç–∏" : "üî¥ –ù–µ –≤ —Å–µ—Ç–∏"}
              </span>
            </div>
            <div class="user-role-badge role-${user.role}">
              ${
                user.role === 'admin' ? 'üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' :
                user.role === 'developer' ? 'üíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫' :
                'üéÆ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
              }
            </div>
          </div>
        `).join("");
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞:", err);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π");
      }
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener("DOMContentLoaded", async () => {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = '/login.html';
        return;
      }

      try {
        const response = await fetch("/user-data", {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });

        if (!response.ok) {
          throw new Error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
        }

        const user = await response.json();
        if (user.role !== 'admin') {
          alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω');
          window.location.href = '/';
          return;
        }

        loadUsers();
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        setInterval(loadUsers, 10000);
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞:', err);
        window.location.href = '/login.html';
      }
    });
  </script>

  <style>
    .user-card {
      padding: 1.5rem;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .user-info-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .user-role-badge {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }

    .role-admin {
      background: linear-gradient(135deg, #ff416c, #ff4b2b);
      color: white;
    }

    .role-developer {
      background: linear-gradient(135deg, #4b6cb7, #182848);
      color: white;
    }

    .role-user {
      background: linear-gradient(135deg, #24C6DC, #514A9D);
      color: white;
    }

    .user-status {
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .status-online {
      background: rgba(76, 175, 80, 0.2);
      color: #4CAF50;
    }

    .status-offline {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }
  </style>
</body>
</html>
